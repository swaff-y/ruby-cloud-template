env:
  ENV_VAR: xyz

steps:
  - label: ":package: Build, Package and run tests"
    commands:
      - "cp ./serverless.yml /Users/kyleswaffield/docker/serverless.yml"
      - "sh .buildkite/scripts/build_and_test.sh"
    agents:
      queue: default
    artifact_paths:
      - "/Users/kyleswaffield/docker/serverless.yml"

  # - name: ":desert_island: Build deployment artifacts"
  #   commands:
  #     - 'docker pull <image>'
  #     - 'docker run --rm etc'
  #   agents:
  #     queue: default
  #   env: 
  #     STAGE: 'dev'
  #   artifact_paths:
  #     - build_deploy.sh
  #     - build_temp.yml


  - wait

  - name: ':desert_island: Deploy'
    commands:
      - "rm serverless.yml"
      - 'buildkite-agent artifact download "Users/kyleswaffield/docker/serverless.yml" .'
      - "cp Users/kyleswaffield/docker/serverless.yml ."
      - 'sls deploy'
    agents:
      queue: default
    # env:
    #   VAR: 'value'

  # - label: ":popcorn: Start deployment"
  #   command: "sh .buildkite/scripts/deployment.sh"
  #   agents:
  #   - "queue=default"
